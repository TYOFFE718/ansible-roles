<VirtualHost *:80>
    DocumentRoot /var/www/audiomack/public
    AllowEncodedSlashes NoDecode

    SetEnv APPLICATION_ENV "production-vpc"

    <Directory /var/www/audiomack/public>
        DirectoryIndex index.php index.html
        AllowOverride None
        Order allow,deny
        Allow from all

        RewriteEngine On

        Options +FollowSymlinks

        RewriteRule ^premium$ /manage/monetization [R=301,L]
        RewriteRule ^manage/change-password$ /account/change-password [R=301,L]

        # cachebreaker rules
        RewriteRule ^((?:cap|js|css)/.*)-cb[0-9]+\.(js|css)$ $1.$2 [NC,L]

        # route all requests to nonexistent files through zend framework's index.php script
        # except stuff in /js/ and /css/ dirs
        RewriteRule ^(?:js|css)/ - [NC,L]

        RewriteCond %{REQUEST_FILENAME} -s [OR]
        RewriteCond %{REQUEST_FILENAME} -l [OR]
        RewriteCond %{REQUEST_FILENAME} -d
        RewriteRule ^.*$ - [NC,L]
        RewriteRule ^.*$ index.php [NC,L]

        <ifmodule mod_expires.c>
        <Filesmatch "\.(jpg|jpeg|png|gif|js|css|swf|ico|woff|mp3)$">
            ExpiresActive on
            ExpiresDefault "access plus 1 hour"
        </Filesmatch>
        </ifmodule>

        Header set Strict-Transport-Security "max-age=31536000"
    </Directory>
</VirtualHost>

